# photos by matt

See [WERF.md](./WERF.md) for werf reference (binary, config, templates, variables, filters, quirks).

---

## Site structure

```
portfolio/
  site/
    _config.yml             # title: "photos by matt"
    _layouts/
      default.liquid        # HTML shell — header/nav/footer wrapper
      photo.liquid          # standalone full-bleed layout (no default wrapper)
      gallery.liquid        # wraps content in .gallery grid
    _includes/
      head.liquid           # meta, Google Fonts (Caveat), CSS link
      nav.liquid            # site title + nav links
      photo_card.liquid     # card with hover overlay (no visible caption)
    _posts/                 # one .md per photo, YYYY-MM-DD-slug.md
    _pages/
      index.html            # home gallery (all photos, uses gallery layout)
      about.md
      [tags].html           # auto-generates one page per tag
    css/
      main.css              # single file, no framework
    public/
      photos/
        originals/
          YYYY-MM-DD/       # scans grouped by date
        thumbs/
          YYYY-MM-DD/       # generated by generate-thumbs.sh, mirrors originals/
    _headers                # Cloudflare CDN cache policy
  scripts/
    build.sh                # Cloudflare entry point (download werf, thumbs, build)
    start.sh                # local dev (download werf if stale, watch mode)
    generate-thumbs.sh      # ImageMagick thumbnail generation, subdir-aware
    new-photo-posts.sh      # creates stub _posts for new images in originals/
    extract-exif.sh         # optional EXIF reader (film scans rarely have useful data)
  WERF.md
  README.md
```

---

## New photo workflow

1. Drop scans into `site/public/photos/originals/YYYY-MM-DD/` (images must be in a dated subdirectory)
2. Run `bash scripts/generate-thumbs.sh` to generate thumbnails
3. Run `bash scripts/new-photo-posts.sh` to generate stub posts
4. Fill in the metadata fields in each new post (see frontmatter schema below)

---

## Scripts

**`scripts/generate-thumbs.sh`** — run before `./werf` (or `new-photo-posts.sh`):

- Finds all images under `site/public/photos/originals/` recursively (jpg, jpeg, png, tiff)
- Mirrors subdirectory structure into `site/public/photos/thumbs/`
- Skips existing thumbs — safe to re-run incrementally
- Resizes to 800×800 centre-crop at quality 85 using ImageMagick (`magick` or `convert`)

**`scripts/new-photo-posts.sh`** — run after adding new photos:

- Scans `site/public/photos/originals/YYYY-MM-DD/` for JPEG images
- Creates `site/_posts/YYYY-MM-DD-<slug>.md` for any without an existing post
- Slug is derived from the filename: underscores → hyphens, lowercased
- Stubs out all frontmatter fields; film fields (`film_name`, `film_format`, `film_type`, `film_speed`, `developed_by`) are left blank and must be filled in manually
- `film_format` defaults to `35mm`
- Idempotent — safe to re-run, skips existing posts
- `--dry-run` flag to preview without writing

**`scripts/extract-exif.sh`** — optional; prints raw EXIF to stdout for a single image. Film scans rarely have useful EXIF.

---

## Per-photo frontmatter schema

```yaml
---
layout: photo
title: "2026-02-24 / 0001_37"
date: 2026-02-24

# Film metadata — fill these in manually
film_name:
film_format: 35mm          # defaults to 35mm
film_type:
film_speed:
developed_by:
exposure_compensation: box  # box / +1 / -1 / +2 etc.
camera:
lens:
location:

tags:                       # space-separated, drives auto-generated tag pages

image: /public/photos/originals/2026-02-24/0001_37.jpg
thumb: /public/photos/thumbs/2026-02-24/0001_37.jpg

description:
---
```

**EXIF note:** Film scans have no useful EXIF — all metadata (film, camera, lens, location) must be entered manually in post frontmatter.

---

## Design

**Fonts**
- `Caveat` (Google Fonts, handwritten) — site title only
- `Georgia` serif — photo card titles on hover overlay
- System sans-serif — body, nav, meta

**Gallery**
- CSS Grid, 6 equal columns, fixed row height (280px)
- Varying column spans per card: `span 2, 1, 1, 1, 2, 1` repeating — gives varied widths at uniform height
- Last card always `grid-column-end: -1` to fill remaining row space
- `object-fit: cover` on all images
- Hover: image scales up, gradient overlay fades in with title + meta in white

**Photo page**
- Standalone layout (`photo.liquid`, not wrapped in `default`)
- Image fills full viewport (`100dvh`), black background, `object-fit: contain`
- Floating nav bar at top fades into image (gradient overlay)
- Scroll down for title, metadata table, tags — dark/moody style

**Color scheme**
- Light: `#fafafa` bg, `#111` fg
- Dark (`prefers-color-scheme`): `#111` bg, `#e8e8e8` fg
- Photo page always dark (`#000` bg)

---

## Deployment on Cloudflare Pages

| Setting | Value |
|---|---|
| Pages project name | `photosbymatt` |
| Production URL | `https://photosbymatt.pages.dev` |
| Build command | `bash scripts/build.sh` |
| Build output directory | `dist` |
| Root directory | `/` |

`scripts/build.sh` downloads the werf Linux binary (tagged by date, requires `GITHUB_PAT`), generates thumbs, builds the site, then copies `site/_headers` to `dist/_headers`.

### Cloudflare cache headers

```
/public/photos/*
  Cache-Control: public, max-age=31536000, immutable

/css/*
  Cache-Control: public, max-age=86400
```

Cloudflare Pages only applies custom headers from an output-root file named `_headers`. This repo keeps the source headers in `site/_headers`; the build script copies it to `dist/_headers` so image/CSS cache policies are actually applied.

`max-age=31536000, immutable` means images can be cached by browsers/CDN for up to one year, so replace image URLs (or filenames) when publishing updated versions of an image.

---

## Open Items

- [ ] Fill in metadata (title, film, camera, lens, location, tags) for the 19 real posts
- [x] Wire up Cloudflare Pages (manual, in dashboard)
- [x] Add favicon
- [ ] About page content
