# Portfolio Site Plan

See [WERF.md](./WERF.md) for werf reference (binary, config, templates, variables, filters).

## Constraints & honest notes on werf

**Tags → auto-generated pages:** werf's `[tags].html` feature auto-generates one page per tag found across all posts. A single `_pages/[tags].html` template handles all tag pages — no need to create individual files per tag. Tag page URLs: `/tags/<tag-name>/`. The template gets `page.title` set to the tag name; filter posts manually in Liquid with `{% if post.tags contains page.title %}`.

**No-JS tag browsing** means tag pages are real URLs: `/tags/agfa-apx-400/`, `/tags/scotland/` etc. Navigation between them is plain anchor links.

**EXIF:** Film scans often retain some EXIF from the scanner (Epson, Plustek etc.) but not camera/film data — that has to be manual. The pre-build script will read whatever EXIF is present (date scanned, resolution) and write it into the frontmatter automatically, leaving the film-specific fields for you to fill in.

**Thumbnail generation:** A pre-build shell script using `ImageMagick` (`convert`) — available on all CI runners, zero extra dependencies.

---

## Site structure

```
portfolio/
  site/
    _config.yml
    _layouts/
      default.liquid      # HTML shell — top nav, no sidebar
      photo.liquid        # single photo: full image + metadata table
      gallery.liquid      # grid of photo cards (home page uses this)
    _includes/
      head.liquid
      nav.liquid          # site-wide nav with tag links
      photo-card.liquid   # thumbnail + title card used in grids
    _posts/               # one .md per photo, YYYY-MM-DD-slug.md
      2024-03-15-glen-coe-roll-1.md
    _pages/
      index.html          # home gallery (all photos, uses gallery layout)
      about.md
      [tags].html         # auto-generates one page per tag
    css/
      main.css            # single file, no framework
    public/
      photos/
        originals/        # full-res scans (gitignored in production)
        thumbs/           # generated by pre-build script
      favicon.ico
    _headers              # Cloudflare CDN cache policy (copied to dist/)
  scripts/
    build.sh              # Cloudflare entry point
    generate-thumbs.sh    # ImageMagick thumbnail generation
    extract-exif.sh       # optional: reads EXIF, patches frontmatter
  WERF.md                 # werf reference doc
  PLAN.md                 # this file
```

---

## Per-photo frontmatter schema

```yaml
---
layout: photo
title: Glen Coe, Roll 1 Frame 12
date: 2024-03-15

# Film metadata (all manual)
film: Agfa APX 400
film_format: 35mm
developed_by: self
exposure_compensation: box       # box / +1 / -1 / +2 etc.
camera: Nikon FM2
lens: 50mm f/1.8
location: Glen Coe, Scotland

# Tagging — space-separated, drives auto-generated tag pages
tags: agfa-apx-400 scotland landscape

# Images (thumbs generated by script)
image: /public/photos/originals/2024-03-15-glen-coe-roll-1.jpg
thumb: /public/photos/thumbs/2024-03-15-glen-coe-roll-1.jpg

# Optional caption
description: Shot at box speed, overcast flat light.
---
```

---

## Tag page template (auto-generated by werf)

`_pages/[tags].html` — werf creates one page per tag automatically:

```html
---
layout: gallery
---

{% for post in site.posts %}
  {% if post.tags contains page.title %}
    {% include 'photo-card' post: post %}
  {% endif %}
{% endfor %}
```

`page.title` is set to the tag name by werf. Adding a new tag = use it in a post's frontmatter, done.

---

## Pre-build scripts

**`scripts/generate-thumbs.sh`** — run before `./werf`:
- Finds all images in `site/public/photos/originals/`
- For each, checks if a thumb already exists (skip if so — fast incremental)
- Runs `convert input -resize 600x600^ -gravity center -extent 600x600 output` (ImageMagick)
- Output goes to `site/public/photos/thumbs/`

**`scripts/extract-exif.sh`** (optional, run once per image):
- Uses `exiftool` to read whatever the scanner wrote (scan date, DPI, dimensions)
- Prints a YAML block you can paste into frontmatter
- Leaves film/camera fields as `# TODO` placeholders
- Doesn't auto-write to files — safer to review first given film scans have inconsistent EXIF

---

## CSS approach

Single `main.css`, no framework. Targets:
- CSS Grid for the photo gallery (auto-fill columns, responsive without media queries where possible)
- Minimal typography: one serif for titles, system font stack for body
- High-contrast black/white aesthetic — suits film photography
- `:hover` state on cards (slight scale + shadow, CSS only)
- `prefers-color-scheme` dark/light variants

---

## Deployment on Cloudflare Pages

Cloudflare Pages has a free tier with unlimited bandwidth and automatic CDN — better fit than Vercel for this use case since images will be large.

### How it works

1. Connect the GitHub repo to Cloudflare Pages (one-time, in the Cloudflare dashboard)
2. Every push to `main` triggers a Cloudflare build
3. Cloudflare runs the build command in a Linux environment
4. The `dist/` folder is deployed to Cloudflare's CDN (~300 edge locations globally)

### Build configuration in Cloudflare dashboard

| Setting | Value |
|---|---|
| Build command | `bash scripts/build.sh` |
| Build output directory | `site/dist` |
| Root directory | `/` |

### `scripts/build.sh`

```bash
#!/usr/bin/env bash
set -euo pipefail

# Download latest werf Linux binary from GitHub Releases
curl -L https://github.com/mattjbones/werf/releases/latest/download/werf-linux -o werf
chmod +x werf

# Generate thumbnails
bash scripts/generate-thumbs.sh

# Build site
cd site && ../werf
```

For local dev on macOS, download `werf-macos` instead (or add platform detection to the script).

### Cloudflare cache headers

`site/_headers` (copied to `dist/` by werf):

```
/public/photos/*
  Cache-Control: public, max-age=31536000, immutable

/css/*
  Cache-Control: public, max-age=86400
```

Photos are cached for a year (immutable once committed). CSS is cached for a day.

Cloudflare Pages handles routing for static sites automatically, including pretty URLs (`/tags/scotland/` → `dist/tags/scotland/index.html`).

---

## Build order

1. `_config.yml` — site config
2. `css/main.css` — grid, typography, photo card styles
3. Layouts — `default.liquid`, `gallery.liquid`, `photo.liquid`
4. Includes — `head.liquid`, `nav.liquid`, `photo-card.liquid`
5. `scripts/generate-thumbs.sh`
6. `scripts/extract-exif.sh`
7. Placeholder photo posts — 3–4 sample `.md` files with placeholder images
8. `_pages/[tags].html` — single template for all tag pages
9. `scripts/build.sh` — Cloudflare entry point + `site/_headers`
10. Wire up Cloudflare Pages (manual, in dashboard)
