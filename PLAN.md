# Portfolio Site Plan

See [WERF.md](./WERF.md) for werf reference (binary, config, templates, variables, filters).

## Constraints & honest notes on werf

**Tags → auto-generated pages:** werf's `[tags].html` feature auto-generates one page per tag found across all posts. A single `_pages/[tags].html` template handles all tag pages — no need to create individual files per tag. Tag page URLs: `/tags/<tag-name>/`. The template gets `page.title` set to the tag name; filter posts manually in Liquid with `{% if post.tags and post.tags contains page.title %}` — the `and post.tags` guard is required because werf errors on `contains` when tags is nil.

**No-JS tag browsing** means tag pages are real URLs: `/tags/agfa-apx-400/`, `/tags/scotland/` etc. Navigation between them is plain anchor links.

**EXIF:** Film scans have no useful EXIF — all metadata (film, camera, lens, location) is entered manually in post frontmatter.

**Thumbnail generation:** `scripts/generate-thumbs.sh` uses ImageMagick. Mirrors subdirectory structure from `originals/` into `thumbs/` (e.g. `originals/2026-02-24/x.jpg` → `thumbs/2026-02-24/x.jpg`).

**New photo workflow:** Drop images into `site/public/photos/originals/YYYY-MM-DD/`, run `bash scripts/new-photo-posts.sh` to generate stub posts, then fill in metadata manually.

---

## Site structure

```
portfolio/
  site/
    _config.yml             # title: "photos by matt"
    _layouts/
      default.liquid        # HTML shell — header/nav/footer wrapper
      photo.liquid          # standalone full-bleed layout (no default wrapper)
      gallery.liquid        # wraps content in .gallery grid
    _includes/
      head.liquid           # meta, Google Fonts (Caveat), CSS link
      nav.liquid            # site title + nav links
      photo_card.liquid     # card with hover overlay (no visible caption)
    _posts/                 # one .md per photo, YYYY-MM-DD-slug.md
      2026-02-24-0001-37.md
      ...                   # 19 real photos as of 2026-02-24
    _pages/
      index.html            # home gallery (all photos, uses gallery layout)
      about.md
      [tags].html           # auto-generates one page per tag
    css/
      main.css              # single file, no framework
    public/
      photos/
        originals/
          YYYY-MM-DD/       # scans grouped by date
        thumbs/
          YYYY-MM-DD/       # generated by generate-thumbs.sh, mirrors originals/
    _headers                # Cloudflare CDN cache policy
  scripts/
    build.sh                # Cloudflare entry point (download werf, thumbs, build)
    start.sh                # local dev (download werf if stale, watch mode)
    generate-thumbs.sh      # ImageMagick thumbnail generation, subdir-aware
    new-photo-posts.sh      # creates stub _posts for new images in originals/
    extract-exif.sh         # optional EXIF reader (film scans rarely have useful data)
  WERF.md
  PLAN.md
```

---

## Per-photo frontmatter schema

```yaml
---
layout: photo
title: "2026-02-24 / 0001_37"
date: 2026-02-24

# Fill these in
film:
film_format: 35mm
developed_by:
exposure_compensation: box    # box / +1 / -1 / +2 etc.
camera:
lens:
location:

tags:                         # space-separated, drives auto-generated tag pages

image: /public/photos/originals/2026-02-24/0001_37.jpg
thumb: /public/photos/thumbs/2026-02-24/0001_37.jpg

description:
---
```

---

## Design

**Fonts**
- `Caveat` (Google Fonts, handwritten) — site title only
- `Georgia` serif — photo card titles on hover overlay
- System sans-serif — body, nav, meta

**Gallery**
- CSS Grid, 6 equal columns, fixed row height (280px)
- Varying column spans per card: `span 2, 1, 1, 1, 2, 1` repeating — gives varied widths at uniform height
- Last card always `grid-column-end: -1` to fill remaining row space
- `object-fit: cover` on all images
- Hover: image scales up, gradient overlay fades in with title + meta in white

**Photo page**
- Standalone layout (`photo.liquid`, not wrapped in `default`)
- Image fills full viewport (`100dvh`), black background, `object-fit: contain`
- Floating nav bar at top fades into image (gradient overlay)
- Scroll down for title, metadata table, tags — dark/moody style

**Color scheme**
- Light: `#fafafa` bg, `#111` fg
- Dark (`prefers-color-scheme`): `#111` bg, `#e8e8e8` fg
- Photo page always dark (`#000` bg)

---

## Tag page template

`_pages/[tags].html`:

```html
---
layout: gallery
---

{% for post in site.posts %}
  {% if post.tags and post.tags contains page.title %}
    {% include 'photo_card' post: post %}
  {% endif %}
{% endfor %}
```

---

## Scripts

**`scripts/new-photo-posts.sh`** — run after adding new photos:
- Scans `site/public/photos/originals/YYYY-MM-DD/` for images
- Creates `site/_posts/YYYY-MM-DD-<slug>.md` for any without an existing post
- Idempotent — safe to re-run, skips existing posts
- `--dry-run` flag to preview without writing

**`scripts/generate-thumbs.sh`** — run before `./werf`:
- Finds all images under `site/public/photos/originals/` recursively
- Mirrors subdirectory structure into `site/public/photos/thumbs/`
- Skips existing thumbs (incremental)
- Resizes to 800×800 crop with ImageMagick (`magick` or `convert`)

**`scripts/extract-exif.sh`** — optional, rarely useful for film scans.

---

## Deployment on Cloudflare Pages

| Setting | Value |
|---|---|
| Build command | `bash scripts/build.sh` |
| Build output directory | `site/dist` |
| Root directory | `/` |

`scripts/build.sh` downloads the werf Linux binary (tagged by date, requires `GITHUB_PAT`), generates thumbs, then builds the site.

### Cloudflare cache headers

```
/public/photos/*
  Cache-Control: public, max-age=31536000, immutable

/css/*
  Cache-Control: public, max-age=86400
```

---

## Known werf quirks

- `exclude` list in `_config.yml` was not respected during static file copy (bug in werf — PR #47 open). Workaround: `dist` is in the exclude list and the PR fix merges it correctly.
- `contains` on a nil `tags` field causes a build error — always guard with `{% if post.tags and post.tags contains ... %}`.
- `site.baseurl` is `/` — don't prepend it to image paths that already start with `/` or you get `//public/...`.
- Include filenames use underscores on disk (`photo_card.liquid`) but can be referenced either way in templates.

---

## Todo

- [ ] Fill in metadata (title, film, camera, lens, location, tags) for the 19 real posts
- [ ] Wire up Cloudflare Pages (manual, in dashboard)
- [ ] Add favicon
- [ ] About page content
